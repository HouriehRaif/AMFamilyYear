<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ajman Map</title>
    <link rel="stylesheet" href="https://js.arcgis.com/4.28/esri/themes/light/main.css">
    <style>
        html, body {
            margin: 0;
            padding: 0;
            height: 100%;
            width: 100%;
            font-family: Avenir Next, W04, sans-serif;
        }
        #viewDiv {
            height: 100%;
            width: 100%;
        }
    </style>
</head>
<body>
    <div id="viewDiv"></div>
    
    <script src="https://js.arcgis.com/4.28/"></script>
    <script>
        let view;
        
        // Embedded GeoJSON data
        const geoJSONData = {
            "Sport_Clubs": {"type":"FeatureCollection","crs":{"type":"name","properties":{"name":"EPSG:32640"}},"features":[{"type":"Feature","id":0,"geometry":{"type":"Point","coordinates":[346701.76740000024,2812381.9697999991]},"properties":{"FID":0,"city":"Ajman","name_ar":"مركز عجمان للشباب","name_en":"Ajman Youth Center","Cat_ar":"أندية رياضية أو ثقافية","Cat_en":"Clubs","phone":"+97166081111","fax":" ","email":"www.uaeyouthsports.com","website":" ","pobox":" ","x":25.420464580000001,"y":55.475723340000002}},{"type":"Feature","id":1,"geometry":{"type":"Point","coordinates":[346063.50349999964,2811829.4778000005]},"properties":{"FID":1,"city":"Ajman","name_ar":"نادي عجمان للشطرنج","name_en":"Ajman Chess Club","Cat_ar":"أندية رياضية أو ثقافية","Cat_en":"Clubs","phone":"+97167421388","fax":"06-7425248","email":" ","website":"www.ajmanchess.com","pobox":" ","x":25.415411089999999,"y":55.469441719999999}},{"type":"Feature","id":2,"geometry":{"type":"Point","coordinates":[346601.22549999971,2812392.0240000002]},"properties":{"FID":2,"city":"Ajman","name_ar":"مركز كواترو الرياضي","name_en":"Quattro Sports Centre","Cat_ar":"أندية رياضية أو ثقافية","Cat_en":"Clubs","phone":"+971551902200","fax":" ","email":" ","website":" ","pobox":" ","x":25.420544970000002,"y":55.47472277}},{"type":"Feature","id":3,"geometry":{"type":"Point","coordinates":[352439.5577999996,2806153.8552999999]},"properties":{"FID":3,"city":"Ajman","name_ar":"مضمار التله لسباق الهجن","name_en":"Talla Camel Race Track","Cat_ar":"أندية رياضية أو ثقافية","Cat_en":"Clubs","phone":"+97167437774","fax":" ","email":" ","website":" ","pobox":" ","x":25.364820000000002,"y":55.533439999999999}},{"type":"Feature","id":4,"geometry":{"type":"Point","coordinates":[347759.44000000041,2810432.4199999999]},"properties":{"FID":4,"city":"Ajman","name_ar":"نادي الفروسية","name_en":"Ajman Stud Farm","Cat_ar":"أندية رياضية أو ثقافية","Cat_en":"Clubs","phone":"+97167691333","fax":" ","email":"info@ajmanstud.com","website":"www.ajmanstud.com","pobox":" ","x":25.402973849999999,"y":55.48645681}},{"type":"Feature","id":5,"geometry":{"type":"Point","coordinates":[346182.4319000002,2811735.3094999995]},"properties":{"FID":5,"city":"Ajman","name_ar":"جمعية عجمان للتنمية الاجتم","name_en":"Ajman Society of Social & Cultural Development","Cat_ar":"أندية رياضية أو ثقافية","Cat_en":"Clubs","phone":"7403911|506302208","fax":" ","email":"ajman.social@gmail.com","website":" ","pobox":" ","x":25.414573310000002,"y":55.470634590000003}},{"type":"Feature","id":6,"geometry":{"type":"Point","coordinates":[344148.46729999967,2809215.9397]},"properties":{"FID":6,"city":"Ajman","name_ar":"نادي عجمان الثقافي الرياضي","name_en":"Ajman Culture & Sport Club","Cat_ar":"أندية رياضية أو ثقافية","Cat_en":"Clubs","phone":"+97167422441","fax":"06-7444244","email":"info@ajmanclub.ae","website":"www.ajmanclub.ae","pobox":"85","x":25.39161846,"y":55.450707819999998}},{"type":"Feature","id":7,"geometry":{"type":"Point","coordinates":[354607.38963248534,2812007.5890694009]},"properties":{"FID":7,"city":"Ajman","name_ar":"نادي الشرطة للرياضة والرما","name_en":" ","Cat_ar":"أندية رياضية أو ثقافية","Cat_en":"Clubs","phone":" ","fax":" ","email":" ","website":" ","pobox":" ","x":0,"y":0}}]}
        };
        
        require(["esri/Map", "esri/views/MapView", "esri/layers/FeatureLayer", "esri/widgets/LayerList", "esri/widgets/Legend", "esri/widgets/Expand", "esri/PopupTemplate"], 
        function(Map, MapView, FeatureLayer, LayerList, Legend, Expand, PopupTemplate) {
            const map = new Map({
                basemap: "satellite"
            });

            view = new MapView({
                container: "viewDiv",
                map: map,
                center: [55.52737998962385, 25.402667492387888],
                zoom: 14
            });

            // Load features from embedded data
            const featureNames = Object.keys(geoJSONData);

            featureNames.forEach(fileName => {
                const iconPath = `${fileName}.svg`;
                const geojson = geoJSONData[fileName];

                // Create dynamic popup template that works with any feature
                const popupTemplate = new PopupTemplate({
                    title: "{name_en}",
                    content: [
                        {
                            type: "fields",
                            fieldInfos: [
                                {
                                    fieldName: "name_ar",
                                    label: "الاسم العربي"
                                },
                                {
                                    fieldName: "name_en",
                                    label: "English Name"
                                },
                                {
                                    fieldName: "Cat_en",
                                    label: "Category"
                                },
                                {
                                    fieldName: "Cat_ar",
                                    label: "التصنيف"
                                },
                                {
                                    fieldName: "city",
                                    label: "City"
                                },
                                {
                                    fieldName: "phone",
                                    label: "Phone"
                                },
                                {
                                    fieldName: "email",
                                    label: "Email"
                                },
                                {
                                    fieldName: "website",
                                    label: "Website"
                                }
                            ]
                        }
                    ]
                });

                // Convert GeoJSON features to graphics using x,y properties (lat/lon)
                const graphics = geojson.features.map((feature, index) => ({
                    geometry: {
                        type: "point",
                        x: feature.properties.y,
                        y: feature.properties.x
                    },
                    attributes: {
                        OBJECTID: feature.id || index,
                        ...feature.properties
                    }
                }));

                // Create FeatureLayer from embedded data
                const layer = new FeatureLayer({
                    source: graphics,
                    objectIdField: "OBJECTID",
                    title: fileName,
                    popupTemplate: popupTemplate,
                    fields: [
                        { name: "OBJECTID", type: "oid" },
                        { name: "name_en", type: "string" },
                        { name: "name_ar", type: "string" },
                        { name: "Cat_en", type: "string" },
                        { name: "Cat_ar", type: "string" },
                        { name: "city", type: "string" },
                        { name: "phone", type: "string" },
                        { name: "email", type: "string" },
                        { name: "website", type: "string" }
                    ],
                    renderer: {
                        type: "simple",
                        symbol: {
                            type: "picture-marker",
                            url: iconPath,
                            width: "28px",
                            height: "28px"
                        }
                    }
                });

                map.add(layer);
            });

            // Add LayerList widget in expand
            const layerList = new LayerList({
                view: view
            });

            const layerListExpand = new Expand({
                view: view,
                content: layerList,
                expanded: false
            });

            view.ui.add(layerListExpand, "top-right");

            // Add Legend widget in expand
            const legend = new Legend({
                view: view
            });

            const legendExpand = new Expand({
                view: view,
                content: legend,
                expanded: false
            });

            view.ui.add(legendExpand, "bottom-left");
        });
    </script>
</body>
</html>
